{"version":3,"sources":["webpack:///D:/code/delicacy/packageUser/pages/edit-profile/edit-profile.vue?4c51","uni-app:///main.js","webpack:///D:/code/delicacy/packageUser/pages/edit-profile/edit-profile.vue?18c0","webpack:///D:/code/delicacy/packageUser/pages/edit-profile/edit-profile.vue?5561","webpack:///D:/code/delicacy/packageUser/pages/edit-profile/edit-profile.vue?97dd","webpack:///D:/code/delicacy/packageUser/pages/edit-profile/edit-profile.vue?c975","uni-app:///packageUser/pages/edit-profile/edit-profile.vue","webpack:///D:/code/delicacy/packageUser/pages/edit-profile/edit-profile.vue?cd5c"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","data","userInfo","_id","avatar","nickname","signature","defaultAvatar","onLoad","console","uni","url","methods","chooseAvatar","count","sizeType","sourceType","err","res","tempFilePath","title","mask","uniCloud","filePath","cloudPath","uploadResult","name","action","params","userId","result","app","localUserInfo","icon","saveProfile","profile","Object","setTimeout","prevPage"],"mappings":";;;;;;;;;AAAA;AACA,OAAO,KAAU,EAAE,kBAKd;;;;;;;;;;;;;;;;ACNL;AAE2D;AAC3D;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,oBAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAyH;AACzH;AACgE;AACL;AACc;;;AAGzE;AAC2K;AAC3K,gBAAgB,6KAAU;AAC1B,EAAE,kFAAM;AACR,EAAE,uFAAM;AACR,EAAE,gGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,2FAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAipB,CAAgB,snBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;eCyCrqB;EACAC;IACA;MACAC;QACAC;QACAC;QACAC;QACAC;MACA;MACAC;IACA;EACA;EAEAC;IACA;IACA;IACAC;IACA;MACAC;QACAC;MACA;MACA;IACA;IAEA;EACA;EAEAC;IACAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAAA;gBAAA,OAGAH;kBACAI;kBACAC;kBACAC;gBACA;cAAA;gBAAA;gBAAA;gBAJAC;gBAAAC;gBAAA,KAMAD;kBAAA;kBAAA;gBAAA;gBAAA,MACA;cAAA;gBAGAE;gBAAA,IACAA;kBAAA;kBAAA;gBAAA;gBAAA,MACA;cAAA;gBAGAT;kBACAU;kBACAC;gBACA;;gBAEA;gBAAA;gBAAA,OACAC;kBACAC;kBACAC;gBACA;cAAA;gBAHAC;gBAAA,IAKAA;kBAAA;kBAAA;gBAAA;gBAAA,MACA;cAAA;gBAAA;gBAAA,OAIAH;kBACAI;kBACAzB;oBACA0B;oBACAC;sBACAC;sBACAzB;oBACA;kBACA;gBACA;cAAA;gBAAA;gBATA0B;gBAAA,MAWAA;kBAAA;kBAAA;gBAAA;gBACA;;gBAEA;gBACAC;gBACA;kBACAA;gBACA;;gBAEA;gBACA;kBACAC;kBACA;oBACAA;oBACAtB;kBACA;gBACA;kBACAD;gBACA;gBAEAC;kBACAU;kBACAa;gBACA;gBAAA;gBAAA;cAAA;gBAAA,MAEA;cAAA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAGAxB;gBACAC;kBACAU;kBACAa;gBACA;cAAA;gBAAA;gBAEAvB;gBAAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEAwB;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAEAxB;kBACAU;gBACA;gBAAA;gBAAA,OAEAE;kBACAI;kBACAzB;oBACA0B;oBACAC;sBACAC;sBACAM;wBACA9B;wBACAD;wBACAE;sBACA;oBACA;kBACA;gBACA;cAAA;gBAAA;gBAbAwB;gBAAA,MAeAA;kBAAA;kBAAA;gBAAA;gBACA;gBACAC;gBACAA;;gBAEA;gBACA;kBACAC;kBACA;oBACAI;sBACA/B;sBACAD;sBACAE;oBACA;oBACAI;kBACA;gBACA;kBACAD;gBACA;gBAEAC;kBACAU;kBACAa;gBACA;;gBAEA;gBACAI;kBACA;kBACA;kBACA;oBACAC;kBACA;kBACA5B;gBACA;gBAAA;gBAAA;cAAA;gBAAA,MAEA;cAAA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAGAD;gBACAC;kBACAU;kBACAa;gBACA;cAAA;gBAAA;gBAEAvB;gBAAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;EACA;AACA;AAAA,2B;;;;;;;;;;;;;AC7NA;AAAA;AAAA;AAAA;AAA4tC,CAAgB,qmCAAG,EAAC,C","file":"packageUser/pages/edit-profile/edit-profile.js","sourcesContent":["// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1739966800023\n      var cssReload = require(\"D:/工作软件/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  ","import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;import '@dcloudio/vue-cli-plugin-uni/packages/uni-cloud/dist/index.js';\nimport Vue from 'vue'\nimport Page from './packageUser/pages/edit-profile/edit-profile.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./edit-profile.vue?vue&type=template&id=5a5934e8&\"\nvar renderjs\nimport script from \"./edit-profile.vue?vue&type=script&lang=js&\"\nexport * from \"./edit-profile.vue?vue&type=script&lang=js&\"\nimport style0 from \"./edit-profile.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../工作软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"packageUser/pages/edit-profile/edit-profile.vue\"\nexport default component.exports","export * from \"-!../../../../../工作软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../工作软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../工作软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../工作软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../工作软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../工作软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./edit-profile.vue?vue&type=template&id=5a5934e8&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../工作软件/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../工作软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../工作软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../工作软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../工作软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./edit-profile.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../工作软件/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../工作软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../工作软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../工作软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../工作软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./edit-profile.vue?vue&type=script&lang=js&\"","<template>\n  <view class=\"edit-profile\">\n    <view class=\"header-bg\">\n      <view class=\"bg-overlay\"></view>\n    </view>\n    \n    <view class=\"content\">\n      <view class=\"avatar-section\" @tap=\"chooseAvatar\">\n        <image\n          :src=\"userInfo.avatar || defaultAvatar\"\n          class=\"avatar\"\n          mode=\"aspectFill\"\n        />\n        <text class=\"tip\">点击更换头像</text>\n      </view>\n\n      <view class=\"form-section\">\n        <view class=\"form-item\">\n          <text class=\"label\">昵称</text>\n          <input\n            type=\"text\"\n            v-model=\"userInfo.nickname\"\n            placeholder=\"请输入昵称\"\n          />\n        </view>\n        <view class=\"form-item\">\n          <text class=\"label\">个性签名</text>\n          <input\n            type=\"text\"\n            v-model=\"userInfo.signature\"\n            placeholder=\"请输入个性签名\"\n          />\n        </view>\n      </view>\n\n      <button class=\"save-btn\" @tap=\"saveProfile\">保存</button>\n    </view>\n  </view>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      userInfo: {\n        _id: \"\",\n        avatar: \"\",\n        nickname: \"\",\n        signature: \"\",\n      },\n      defaultAvatar: \"/static/default-avatar.png\",\n    };\n  },\n\n  onLoad() {\n    const app = getApp();\n    const userInfo = app.globalData.userInfo;\n    console.log(userInfo,'userInfo')\n    if (!userInfo || !userInfo._id) {\n      uni.navigateTo({\n        url: '/pages/auth/login'\n      });\n      return;\n    }\n    \n    this.userInfo = { ...userInfo };\n  },\n\n  methods: {\n    async chooseAvatar() {\n      try {\n        // 选择图片\n        const [err, res] = await uni.chooseImage({\n          count: 1,\n          sizeType: ['compressed'],\n          sourceType: ['album', 'camera']\n        });\n\n        if (err) {\n          throw new Error('选择图片失败');\n        }\n\n        const tempFilePath = res.tempFilePaths[0];\n        if (!tempFilePath) {\n          throw new Error('未获取到图片');\n        }\n\n        uni.showLoading({\n          title: '上传中...',\n          mask: true\n        });\n\n        // 上传图片到云存储\n        const uploadResult = await uniCloud.uploadFile({\n          filePath: tempFilePath,\n          cloudPath: `avatar/${this.userInfo._id}_${Date.now()}.jpg`\n        });\n\n        if (!uploadResult.fileID) {\n          throw new Error('上传失败');\n        }\n\n        // 更新用户头像\n        const { result } = await uniCloud.callFunction({\n          name: 'user',\n          data: {\n            action: 'uploadAvatar',\n            params: {\n              userId: this.userInfo._id,\n              avatar: uploadResult.fileID\n            }\n          }\n        });\n\n        if (result.code === 0) {\n          this.userInfo.avatar = uploadResult.fileID;\n          \n          // 更新全局用户信息\n          const app = getApp();\n          if (app.globalData.userInfo) {\n            app.globalData.userInfo.avatar = uploadResult.fileID;\n          }\n          \n          // 更新本地存储\n          try {\n            const localUserInfo = uni.getStorageSync('userInfo');\n            if (localUserInfo) {\n              localUserInfo.avatar = uploadResult.fileID;\n              uni.setStorageSync('userInfo', localUserInfo);\n            }\n          } catch (e) {\n            console.error('更新本地存储失败:', e);\n          }\n\n          uni.showToast({\n            title: '上传成功',\n            icon: 'success'\n          });\n        } else {\n          throw new Error(result.msg || '更新头像失败');\n        }\n      } catch (error) {\n        console.error('上传头像失败:', error);\n        uni.showToast({\n          title: error.message || '上传失败',\n          icon: 'none'\n        });\n      } finally {\n        uni.hideLoading();\n      }\n    },\n\n    async saveProfile() {\n      try {\n        uni.showLoading({\n          title: \"保存中...\",\n        });\n\n        const { result } = await uniCloud.callFunction({\n          name: \"user\",\n          data: {\n            action: \"updateProfile\",\n            params: {\n              userId: this.userInfo._id,\n              profile: {\n                nickname: this.userInfo.nickname,\n                avatar: this.userInfo.avatar,\n                signature: this.userInfo.signature,\n              },\n            },\n          },\n        });\n\n        if (result.code === 0) {\n          // 更新全局用户信息\n          const app = getApp();\n          app.globalData.userInfo = { ...this.userInfo };\n          \n          // 更新本地存储\n          try {\n            const localUserInfo = uni.getStorageSync('userInfo');\n            if (localUserInfo) {\n              Object.assign(localUserInfo, {\n                nickname: this.userInfo.nickname,\n                avatar: this.userInfo.avatar,\n                signature: this.userInfo.signature,\n              });\n              uni.setStorageSync('userInfo', localUserInfo);\n            }\n          } catch (e) {\n            console.error('更新本地存储失败:', e);\n          }\n\n          uni.showToast({\n            title: \"保存成功\",\n            icon: \"success\",\n          });\n\n          // 返回上一页并刷新\n          setTimeout(() => {\n            const pages = getCurrentPages();\n            const prevPage = pages[pages.length - 2];\n            if (prevPage) {\n              prevPage.$vm.refreshUserInfo && prevPage.$vm.refreshUserInfo();\n            }\n            uni.navigateBack();\n          }, 1500);\n        } else {\n          throw new Error(result.msg || \"保存失败\");\n        }\n      } catch (error) {\n        console.error(\"保存资料失败:\", error);\n        uni.showToast({\n          title: error.message || \"保存失败\",\n          icon: \"none\",\n        });\n      } finally {\n        uni.hideLoading();\n      }\n    },\n  },\n};\n</script>\n\n<style lang=\"scss\">\n.edit-profile {\n  min-height: 100vh;\n  background-color: #f8f8f8;\n  position: relative;\n\n  .header-bg {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 360rpx;\n    background: linear-gradient(215deg, #ff6b6b, #ff8e8e, #ffd3d3);\n    overflow: hidden;\n    z-index: 1;\n\n    &::before {\n      content: '';\n      position: absolute;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: radial-gradient(circle at 70% 30%, rgba(255, 255, 255, 0.2) 0%, transparent 60%);\n    }\n\n    &::after {\n      content: '';\n      position: absolute;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: linear-gradient(45deg, transparent 45%, rgba(255, 255, 255, 0.1) 50%, transparent 55%);\n      background-size: 200% 200%;\n      animation: shine 3s infinite linear;\n    }\n\n    .bg-overlay {\n      position: absolute;\n      bottom: 0;\n      left: 0;\n      width: 100%;\n      height: 40%;\n      background: linear-gradient(to bottom, transparent, #f8f8f8);\n      z-index: 2;\n    }\n  }\n\n  @keyframes shine {\n    0% {\n      background-position: 200% 0;\n    }\n    100% {\n      background-position: -200% 0;\n    }\n  }\n\n  .content {\n    position: relative;\n    z-index: 2;\n    padding: 30rpx;\n  }\n\n  .avatar-section {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    padding: 40rpx 0;\n    background-color: #fff;\n    border-radius: 12rpx;\n    margin-bottom: 30rpx;\n    box-shadow: 0 4rpx 16rpx rgba(0, 0, 0, 0.1);\n\n    .avatar {\n      width: 160rpx;\n      height: 160rpx;\n      border-radius: 50%;\n      margin-bottom: 20rpx;\n      border: 4rpx solid #fff;\n      box-shadow: 0 4rpx 8rpx rgba(0, 0, 0, 0.1);\n    }\n\n    .tip {\n      font-size: 24rpx;\n      color: #999;\n    }\n  }\n\n  .form-section {\n    background-color: #fff;\n    border-radius: 12rpx;\n    padding: 0 30rpx;\n    box-shadow: 0 4rpx 16rpx rgba(0, 0, 0, 0.1);\n\n    .form-item {\n      display: flex;\n      align-items: center;\n      padding: 30rpx 0;\n      border-bottom: 1rpx solid #eee;\n\n      &:last-child {\n        border-bottom: none;\n      }\n\n      .label {\n        width: 160rpx;\n        font-size: 28rpx;\n        color: #333;\n      }\n\n      input {\n        flex: 1;\n        font-size: 28rpx;\n        color: #333;\n      }\n    }\n  }\n\n  .save-btn {\n    margin-top: 60rpx;\n    background: linear-gradient(45deg, #ff6b6b, #ff8e8e);\n    color: #fff;\n    border-radius: 12rpx;\n    font-size: 32rpx;\n    box-shadow: 0 4rpx 16rpx rgba(255, 107, 107, 0.3);\n\n    &:active {\n      opacity: 0.9;\n      transform: translateY(2rpx);\n    }\n  }\n}\n</style>\n","import mod from \"-!../../../../../工作软件/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../工作软件/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../工作软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../工作软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../工作软件/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../工作软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../工作软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../工作软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../工作软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./edit-profile.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../../../../工作软件/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../工作软件/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../工作软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../工作软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../工作软件/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../工作软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../工作软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../工作软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../工作软件/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./edit-profile.vue?vue&type=style&index=0&lang=scss&\""],"sourceRoot":""}